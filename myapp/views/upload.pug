extends layout
block title
    title 图片上传
    style.
        .my-class {
            margin: 1rem auto 0;
            width: 120px;
            height: 120px;
            border: 1px dotted gray;
            text-align: center;
            line-height: 120px;
            transition: all 0.1s linear;
            cursor: pointer;
            border-radius: 5px;
            position: relative;
        }

        .my-class:hover {
            border-color: #1d9aff;
        }

        .iconfont.icon-jiajian- {
            font-size: 50px;
            color: gray;
            font-weight: normal;
        }

        .my-img {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            z-index: 1;
        }
    script.
block content
    div.container-fluid.p-0
        div.card.m-auto.w-75
            div.card-header
                span 图片上传
            div.card-body
                div.text-center
                    form#uploadForm
                        input(type="file").d-none
                div.my-class
                    i.iconfont.icon-jiajian-
                    img(src="#").my-img
            div.card-footer
                //div.alert.alert-danger#error
                //    strong 提示！
    script.
      var $file = $("[type=file]");
      $(".my-class").click(function () {
        $file.click();
      })
      //（1）图片上传,加密,前台显示 （2）接口的回调
      $file.change(function (e) {
        var file = e.target.files[0];
        var formdata = new FormData($("#uploadForm")[0]);
        formdata.append("files", file);
        //分析上传本地 新建文件storage目录存储本地图片
        $.ajax({
          url: "/upload/handlePhoto",
          type: "POST",
          data: formdata,
          mimeType: "multipart/form-data",//多部件的
          contentType: false,
          processData: false,//默认将数据转化为对象
          //dataType:"JSON",//加上这里就自动解析json
          success: function (data) {
            data = JSON.parse(data);
            $(".my-img").attr({src: data.msg.img}).show();
            layer.msg(`返回信息：${data.msg.info}`, {time: 5000});
          },
          error: function (err) {
            layer.msg(`上传失败：${err.statusText}`, {time: 5000});
          }
        })
      })

